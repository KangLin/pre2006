<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>WinPcap: 如何编译WinPcap</title>
<link href="style.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.1 -->
<!-- Translated By CoffeeCat (Chinese)-->
<!-- http://www.CoffeeCat.net.cn-->
<div class="tabs">
  <ul>
    <li id="current"><a href="main.html"><span>主 页</span></a></li>
    <li><a href="modules.html"><span>模块</span></a></li>
    <li><a href="annotated.html"><span>数据结构</span></a></li>
    <li><a href="files.html"><span>文件</span></a></li>
    <li><a href="pages.html"><span>相关页面</span></a></li>
  </ul></div>
<h1>如何编译WinPcap<br>
<small>
[<a class="el" href="group__internals.html">WinPcap核心资料</a>]</small>
</h1><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
</table>
<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<meta name="GENERATOR" content="Microsoft FrontPage 6.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<title></title>
</head>

<body>
<p>这部分内容将告诉你，在不同的win32平台上，如何编译WinPcap。源代码可以在<a href="http://www.winpcap.org/">WinPcap 网站</a>上获得。</p>
<h2>编译驱动</h2>
<p>编译NPF时，有两个主要的路径：Windows NTx和Windows 9x。注意，因为NPF驱动是与平台相关的，所以，为了连接正确的DDK库，我们强烈建议编译的时候，要选择将来会被使用的那个操作系统。比如，如果你使用Windows NT 4 DDK库赖编译驱动，那么在Windows2000或其他操作系统上运行，将不会那么顺利了。</p>
<h3>在Windows NT4平台上编译驱动</h3>
<p>软件需求：</p>
<ul>
	<li>Microsoft Driver Developer Kit (DDK) for Windows NT4</li>
	<li>能在Visual Studio 6上编译的Microsoft Platform Software Development Kit (SDK)的较新的版本(最新的平台发布于2003年2月)。这个版本的PSDK在Microsoft的网站上提供，参见：<a href="http://www.microsoft.com/msdownload/platformsdk/sdkupdate/psdk-full.htm">http://www.microsoft.com/msdownload/platformsdk/sdkupdate/psdk-full.htm</a>。同时，它也可以在线订阅：<a href="http://www.qmedia.ca/launch/psdk.htm">http://www.qmedia.ca/launch/psdk.htm</a>，同时，在微软的用户下载网站里，也为微软MSDN用户提供了订阅。
	<li>Microsoft Visual C++ 6.0 with Service Pack 5 or 6 (这两个版本在微软的网站上都有提供).</ul>
<p>如果你的系统符合上面的三个要求，那么请按照下列步骤：</p>
<ol>
  <li>从Windows NT 开始 菜单，选择 <em>程序</em> 然后选择 <i>Development Kits</i>, 然后选择 <em>Windows NT4 DDK.</em> 
    在这里，如果你想建立一个调试版本，你可以选择<em>Checked Build
    Environment</em> ，如果你想建立一个发布版本，你可以选择 <em>Free Build
    Environment</em> 。
  <li>一个命令提示框将被打开。用cd命令移到WinPcap文件夹下的PacketNTx文件夹，输入命令： 
  <br>
  <br><i>CompileDriver<br></i>
	<br>这个脚本会产生一个驱动 (npf.sys)，然后，二进制数据会被放入下列文件夹中的一个<ul>
	<li><i>Free Build Environment: </i>winpcap\PacketNTx\driver\bin\NT4\i386\free</li>
	<li><i>Checked Build Environment: </i>winpcap\PacketNTx\driver\bin\NT4\i386\checked</li>
	</ul>
</ol>
<p><b>警告</b>: 有时，在编译驱动的过程中，会产生很多'last line incomplete'错误提示。忽略这些错误，并且让编译过程继续进行。它们的产生是由于某些版本的DDK的bug所引起的。</p>
<h3>
在Windows 2000/XP/2003/Vista(32位和64位AMD64)平台上编译驱动
</h3>
<p>软件需求：</p>
<ul>
	<li>Microsoft Driver Developer Kit (DDK) for Windows Windows
    XP or Windows Server 2003. 对于 WinPcap 4.0, 最合适的 DDK 
	environment 是 &quot;DDK for Windows Server 2003SP1&quot;, 也可以称作 DDK 
	3790.1830.</li>
</ul>
<p>注意： 在Windows 2000下使用旧的DDK是可以的，但是，你需要手动地修改编译脚本来禁用PREfast。(PREfast是一个静态代码分析工具，捆绑在较新的DDK中)</p>
<p>如果你的系统满足以上需求，那么请按下列步骤进行：</p>
<ol>
  <li>从Windows NT 开始 菜单，选择 <em>程序</em> 然后选择 <i>Development Kits</i>, 然后选择 <em>Windows XXX DDK.</em>, <em>XXX</em> 就是你的目的系统，然后选择
    <em>Build Environments</em>.<ul>
	<li>32bit 驱动: 选择 <em>Windows 2000</em> ，然后，如果你想建立一个发布版本的程序，请选择  <em>Windows 2000 Free Build 
	Environment</em>，如果你想建立一个调试版本的程序，请选择 <em>Windows 2000 
	Checked Build Environment </em>。 </li>
	<li>64bit AMD64 驱动: 选择 <em>Windows Server 2003</em> 然后，如果你想建立一个发布版本的程序，请选择 <em>Windows 
	Server 2003 Free&nbsp; x64 Build Environment </em>如果你想建立一个调试版本的程序，请选择
	<em>Windows Server 2003 Checked x64 Build Environment </em>。</li>
	</ul>
  <li>一个命令提示框将被打开。用cd命令移到WinPcap文件夹下的PacketNTx文件夹，输入命令： 
	<br><br><i>CompileDriver<br></i>
	<br>这个脚本会产生一个驱动 (npf.sys)，然后，二进制数据会被放入下列文件夹中的一个<ul>
		<li><i>32bit driver (both Free and Checked Build): </i>winpcap\PacketNTx\driver\bin\2k\i386</li>
		<li><i>64bit AMD64 driver (both Free and Checked Build): </i>winpcap\PacketNTx\driver\bin\xp\amd64</li>
	</ul>
</ol>
<h3>在Windows 9x平台上编译驱动</h3>
<p><font color="#FF0000">注意: WinPcap已经不再支持这个Windows平台。然而，一些在代码包中，基于这些操作系统的源代码还是可用的。 </font></p>
<p>要在Windows 9x上编译驱动，你需要：</p>
<ul>
  <li>Driver Developer Kit (DDK) for Windows 95/98/ME
  <li>能在Visual Studio 6上编译的Microsoft Platform Software Development Kit (SDK)的较新的版本(最新的平台发布于2003年2月)。这个版本的PSDK在Microsoft的网站上提供，参见：<a href="http://www.microsoft.com/msdownload/platformsdk/sdkupdate/psdk-full.htm">http://www.microsoft.com/msdownload/platformsdk/sdkupdate/psdk-full.htm</a>。同时，它也可以在线订阅：<a href="http://www.qmedia.ca/launch/psdk.htm">http://www.qmedia.ca/launch/psdk.htm</a>，同时，在微软的用户下载网站里，也为微软MSDN用户提供了订阅。
  <li>Microsoft Visual C++ 6.0 with Service Pack 5 or 6 (这两个版本在微软的网站上都有提供).</ul>
<p>然后，按下列步骤进行：</p>
<ol>
  <li>打开DOS
  <li>进入 VisualC++ BIN 目录 (比如 C:\DEVSTUDIO\VC\BIN) 并执行命令
    <br>
    <br>
    <em>Vcvars32<br>
    </em>
  <li>进入 SDK 目录 (比如 C:\MSSDK) 并执行命令<br>
    <br>
    <em>Setenv sdk_path</em><br>
    <br>
     <em>sdk_path</em> 是 SDK 目录(比如 Setenv C:\MSSDK)
  <li>进入 DDK 目录 (比如 C:\DDK) 并执行命令<br>
    <br>
    <em>Ddkenv 32 net<br>
    </em>
  <li>进入驱动源代码所在目录，并执行命令<br>
    <br>
    <em>nmake rtl<br>
    <br>
    </em>来获得发布版本，或者执行<br>
    <br>
    <em>nmake<br>
    <br>
    </em>来获得调试版本<br>发布版本的 <i>packet.vxd</i> 将会出现在 
	<em>retail</em>
    目录下, 调试版本将会出现在 <em>debug</em> 目录下</li>
</ol>
<p><strong>警告</strong>: 在一些系统中， NMAKE 使用工具并不能启动 ADRC2VXD, 这一位着驱动二进制数据的产生是正确的，不过没有版本信息。我们还不知道引起这个问题的原因。</p>
<h2>编译 packet.dll</h2>
<p>这个DLL的源路径在 PacketNTx\dll\ </p>
<p><font color="#FF0000">注意: WinPcap已经不再支持这个Windows平台。然而，一些在代码包中，基于这些操作系统的源代码还是可用的。 </font></p>
<p>软件需求：</p>
<ul>
	<li>能在Visual Studio 6上编译的Microsoft Platform Software Development Kit (SDK)的较新的版本(最新的平台发布于2003年2月)。这个版本的PSDK在Microsoft的网站上提供，参见：<a href="http://www.microsoft.com/msdownload/platformsdk/sdkupdate/psdk-full.htm">http://www.microsoft.com/msdownload/platformsdk/sdkupdate/psdk-full.htm</a>。同时，它也可以在线订阅：<a href="http://www.qmedia.ca/launch/psdk.htm">http://www.qmedia.ca/launch/psdk.htm</a>，同时，在微软的用户下载网站里，也为微软MSDN用户提供了订阅。

    <br><b>注意</b>: 如果你使用 Microsoft Visual Studio .NET ，那么平台SDK是不需要编译packet.dll的。
	<li>Microsoft Visual C++ 6.0 with Service Pack 5 or 6 (这两个版本在微软的网站上都有提供).
	<li>如果你想用WinPcap建立一个支持CACE无线包捕获技术的程序，你需要从<a href="http://www.cacetech.com/products/airpcap.htm">http://www.cacetech.com/products/airpcap.htm</a>下载AirPcap developer's pack。The AirPcap developer's pack需要被解压到和WinPcap同一个目录下。</ul>
<p>要编译 PACKET.DLL, 在Visual C++平台下，加载一个包含了目录 PacketNTx\dll\project
的工程。 以下是一些工程的配置：</p>
<ul>
  <li><i>PacketNT - Win32</i> <i>Release</i>: 标准发行版配置</li>
  <li><i>PacketNT - Win32 Debug</i>: 标准调试版配置</li>
  <li><i>PacketNT - Win32</i> <i>Release No AirPcap</i>: 标准发行版配置，不支持AirPcap </li>
  <li><i>PacketNT - Win32 Debug No AirPcap</i>: 标准调试版配置, 不支持AirPcap </li>
  <li><i>PacketNT - Win32 NT4 Release</i>: 运行于NT4的发行版本配置，不包括对Wan和IP helper API的支持。 </li>
	<li><i>PacketNT - Win32 NT4 Debug</i>: 运行于NT4的调试版本配置，不包括对Wan和IP helper API的支持。 </li>
  <li><i>PacketNT - Win32 Release Vista</i>: 运行于Vista的发行版本配置，不包括对Wan的支持(以及NetMon API)。</li>
	<li><i>PacketNT - Win32 Debug Vista</i>: 运行于Vista的调试版本配置，不包括对Wan的支持(以及NetMon API)。</li>
	<li><i>WanPacket - Win32 Release</i>: 使用WanPacket 库的发行版本，用于同NetMon API进行广域网捕捉。 </li>
	<li><i>WanPacket - Win32 Debug</i>: 使用WanPacket 库的调试版本，用于同NetMon API进行广域网捕捉。</li>
</ul>
<p>选择一种需要的配置，并建立工程来获取二进制文件。</p>
<h2>编译 wpcap.dll</h2>
<p>wpcap.dll 可以在任何 Win32 平台下编译，产生的dll是平台相关的。</p>
<p>系统需求:</p>
<ul>
  <li>Microsoft Visual C++ 6.0 with Service Pack 5 or 6 (这两个版本在微软的网站上都有提供).
</li>
	<li>能在Visual Studio 6上编译的Microsoft Platform Software Development Kit (SDK)的较新的版本(最新的平台发布于2003年2月)。这个版本的PSDK在Microsoft的网站上提供，参见：<a href="http://www.microsoft.com/msdownload/platformsdk/sdkupdate/psdk-full.htm">http://www.microsoft.com/msdownload/platformsdk/sdkupdate/psdk-full.htm</a>。同时，它也可以在线订阅：<a href="http://www.qmedia.ca/launch/psdk.htm">http://www.qmedia.ca/launch/psdk.htm</a>，同时，在微软的用户下载网站里，也为微软MSDN用户提供了订阅。

    <br><b>注意</b>: 如果你使用 Microsoft Visual Studio .NET ，那么平台SDK是不需要编译wpcap.dll的。
</li>
	<li>WinPcap源代码的工程文件位于<i> winpcap\wpcap\prj</i> . 从 Visual C++ 开发平台上加载wpcap.dsw并构建程序。</li>
	<li>如果你想用WinPcap建立一个支持CACE无线包捕获技术的程序，你需要从<a href="http://www.cacetech.com/products/airpcap.htm">http://www.cacetech.com/products/airpcap.htm</a>下载AirPcap developer's pack。The AirPcap developer's pack需要被解压到和WinPcap同一个目录下。
	<br>
	<br>
	以下是八种工程的配置：<b><br><br>不支持远程捕获，支持AirPcap，不支持DAG, </b></li>
	<li><i>Wpcap debug</i>: 目录输出： winpcap\wpcap\prj\Debug </li>
	<li><i>Wpcap release</i>: 目录输出： winpcap\wpcap\prj\Release<b><br>
	<br>
	支持远程捕获，不支持AirPcap，不支持DAG</b></li>
	<li><i>Wpcap debug REMOTE NO AIRPCAP</i>: 目录输出： winpcap\wpcap\prj\Debug_REMOTE_NO_AIRPCAP</li>
	<li><i>Wpcap release REMOTE NO AIRPCAP</i>: 目录输出： winpcap\wpcap\prj\Release_REMOTE_NO_AIRPCAP<p>
	<b>支持远程捕获，支持AirPcap，不支持DAG</b></li>
	<li><i>Wpcap debug REMOTE</i>: 目录输出： winpcap\wpcap\prj\Debug_REMOTE</li>
	<li><i>Wpcap release REMOTE</i>: 目录输出： winpcap\wpcap\prj\Release_REMOTE<br><b><br>
	支持远程捕获，支持AirPcap，支持DAG</b></li>
	<li><i>Wpcap debug REMOTE DAG</i>: 目录输出： winpcap\wpcap\prj\Debug_REMOTE_DAG</li>
	<li><i>Wpcap release REMOTE DAG</i>: 目录输出： winpcap\wpcap\prj\Release_REMOTE_DAG</li>
</ul>
<p><i>注意</i>: wpcap.dll 包含了来自
<a href="http://www.tcpdump.org">www.tcpdump.org</a> 的libpcap的源代码，对于远程捕获有一些修改。
 你能包含和构建一个不同版本的libpcap，只需要简单地把它拷贝到<i>winpcap\wpcap\prj</i>下的WinPcap源代码中即可，但是，你必须使用"Debug(调试)"或"Release(发行)"进行配置。<br>
&nbsp;</p>

</body>

</html>
 
<hr>
<p align="right"><img border="0" src="winpcap_small.gif" align="absbottom" width="91" height="27">
documentation. Copyright (c) 2002-2005 Politecnico di Torino. Copyright (c) 2005-2007 
CACE Technologies. All rights reserved.
<br>2007 Translated By <a href="http://www.CoffeeCat.net.cn" target="_blank">CoffeeCat Studio</a>
</p>
