<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>WinPcap: 远程捕获</title>
<link href="style.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.1 -->
<!-- Translated By CoffeeCat (Chinese)-->
<!-- http://www.CoffeeCat.net.cn-->
<div class="tabs">
  <ul>
    <li id="current"><a href="main.html"><span>主 页</span></a></li>
    <li><a href="modules.html"><span>模块</span></a></li>
    <li><a href="annotated.html"><span>数据结构</span></a></li>
    <li><a href="files.html"><span>文件</span></a></li>
    <li><a href="pages.html"><span>相关页面</span></a></li>
  </ul></div>
<h1>远程捕获</h1><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>模块</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__remote__struct.html">输出结构与定义</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__remotefunc.html">输出函数</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__remote__pri__func.html">内部函数</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__remote__pri__struct.html">内部结构与定义</a></td></tr>

</table>
<hr><a name="_details"></a><h2>详细描述</h2>
<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<title>使用 WinPcap 远程捕获</title>
</head>

<body>

<hr>
<ul>
  <li><a href="#RunningModes">远程捕获运行模式</a></li>
  <li><a href="#Config">配置远程程序(rpcapd)</a></li>
  <li><a href="#StartCap">在远程机器上启动捕获</a></li>
  <li><a href="#UNIX">在Unix机器上安装远程捕获程序</a></li>
</ul>
<hr>
<p>WinPcap拥有远程捕获的能力。这个高级特性能够捕获在远程网络上传输的数据包。</p>
<p>它需要一个 <b>远程后台程序(remote daemon) </b>(被称为<code>rpcapd</code>) ，它进行捕获，并把捕获到的数据发回。一个 <b>本地客户端</b> 会发送合适的命令并接收捕获到的数据。</p>
<p>WinPcap扩展了标准的WinPcap代码，这样，基于WinPcap的工具可以拥有远程捕获的能力。例如：远程后台程序被加入到客户软件中，我们并不需要另外修改，就能使程序拥有远程捕捉的能力。反之亦然，远程后台程序必须被安装(和配置)在远程机器上。</p>
<h2><a name="RunningModes"></a>远程捕获运行模式</h2>
<p>远程捕获协议 (RPCAP) 可以在两种模式下工作：</p>
<ul>
  <li><b>被动模式(Passive Mode)</b> (默认): 客户机 (比如 a network sniffer)
    连接到远程后台程序, 它发送一些合适的命令，并开始捕获。</li>
  <li><b>主动模式(Active Mode)</b>: 远程后台程序试图连接到客户机 (比如 the network sniffer); 然后，客户机发送一些合适的命令，并开始捕获。
    主动这个词的来历是因为远程后台程序 <i>主动</i>建立连接，而不是 <i>等待</i>
    新的连接。</li>
</ul>
<p>主动模式是有用的，除了当远程后台程序遇到了防火墙的阻止而不能访问外部网络时。在这种情况下，远程后台程序可以被配置成允许与已知的主机建立连接，而那个主机，只需要配置成等待连接即可。在连接建立完成之后，协议会继续自己的工作，这些工作在主动模式和被动模式下几乎是一样的。</p>
<p>Analyzer (<a href="http://analyzer.polito.it/30alpha/">http://analyzer.polito.it/30alpha/</a>)
有一系列的命令 (在 <b>Capture</b> 菜单中) 。这些命令允许你接收一个远程连接，然后再远程设备上启动捕获。由于Analyzer需要一些代码上的修正，所以目前，它仅能工作在主动模式下。</p>
<h2><a name="Config"></a>配置远程后台程序 (rpcapd)</h2>
<p>远程后台程序是一个标准的Win32可执行进程，它可以运行于受控模式或作为一个服务器。可执行进程可以在进入WinPcap文件夹后，使用下列语法找到它：</p>
<pre>        rpcapd [-b &lt;address&gt;] [-p &lt;port&gt;] [-6] [-l &lt;host_list&gt;] [-a &lt;host,port&gt;] 
               [-n] [-v] [-d] [-s &lt;file&gt;] [-f &lt;file&gt;]</pre>
<p>后台进程也可以在Linux平台上编译并运行</p>
<p>以下是可用命令的简要描述</p>
<div align="left">
  <table border="1">
    <tr>
      <th>Switch</th>
      <th>Description</th>
    </tr>
    <tr>
      <td>
        <pre>-b &lt;address&gt;</pre>
      </td>
      <td>设置所绑定的程序的地址 (数字或文字的都行)。默认情况下，它将绑定所有的本地IPv4和IPv6地址。</td>
    </tr>
    <tr>
      <td>
        <pre>-p &lt;port&gt;</pre>
      </td>
      <td>设置所绑定的程序的端口，默认为2002</td>
    </tr>
    <tr>
      <td>
        <pre>-4</pre>
      </td>
      <td>只绑定IPv4地址。默认：IPv4和IPv6被用于等待的sockets</td>
    </tr>
    <tr>
      <td>
        <pre>-l &lt;host_list_file&gt;</pre>
      </td>
      <td>它指明了一个包含允许程序连接的主机列表的文件(如果有多个，那么每行表示1个)。我们建议使用文字(而不是用数字)来描述，因为这样可以避免与IPv4或IPv6的地址发生误会。</td>
    </tr>
    <tr>
      <td>
        <pre>-n</pre>
      </td>
      <td>它允许 NULL 的认证 (通常和 '-l' 一起使用, 这样能保证只有被允许的主机才能连接到程序)。
        默认情况下，用于身份认证的用户名/密码是必须的。</td>
    </tr>
    <tr>
      <td>
        <pre>-a &lt;host, port&gt;</pre>
      </td>
      <td>它强制程序运行在主动模式下，并在port端口，与主机host建立连接。这个并不标明，后台程序就不能运行在被动模式下了。</td>
    </tr>
    <tr>
      <td>
        <pre>-v</pre>
      </td>
      <td>它强制程序只能运行于主动模式下。(默认情况：程序总是接受主动连接，即使指定了-a)</td>
    </tr>
    <tr>
      <td>
        <pre>-d</pre>
      </td>
      <td>强制程序在后台运行，例如，作为一个后台程序(仅Unix)或作为一个服务程序(仅Win32)。<b>警告(Win32)</b>：当WinPcap将这个程序安装进了Win32的服务中时，这个交换是自动提供的。(控制面板->管理工具->服务)</td>
    </tr>
    <tr>
      <td>
        <pre>-s &lt;file&gt;</pre>
      </td>
      <td>把当前配置保存到文件</td>
    </tr>
    <tr>
      <td>
        <pre>-f &lt;file&gt;</pre>
      </td>
      <td>从文件中加在配置信息。所有由命令行参数指明的交换都将会被忽略，代替它的，是文件内的设置</td>
    </tr>
    <tr>
      <td>
        <pre>-h</pre>
      </td>
      <td>在屏幕上打印帮助信息</td>
    </tr>
  </table>
</div>
<h3>安装远程后台程序</h3>
<p>在安装WinPcap时，远程后台程序被自动安装。这个安装过程将rpcapd文件放入WinPcap文件夹中。这个文件可以用命令行方式执行，也可以作为一个服务。例如，安装过程更新了可用服务的列表，并创建了一个新的项目(<b>远程数据包捕获协议 v.0 (试验中)</b>)。为了避免安全问题，服务是不激活的，它需要手工启动它。(控制面板->管理工具->服务->启动)</p>
<p>这个服务有一组 &quot;标准&quot; 的参数， 例如：使用&quot;-d&quot;标志和&quot;-f rpcapd.ini&quot;标志启动(为了让它作为一个服务运行)。用户可以在与可执行进程相同的目录下，创建一个名为rpcapd.ini的文件，然后把配置命令放在里面。为了让服务执行这些命令，你需要重启服务。(初始化文件只会在开始运行的时候被揭西)。反之亦然，Unix版本的<code>rpcapd</code>在发送kill -HUP标志时，读取配置文件。在这种情况下，所有的已存在的连接都会保留原有配置，而新的连接则会根据新的配置参数创建。</p>
<p>万一用户不想手工创建配置文件，它可以使用加上了&quot;-s filename&quot;的请求参数来启动<code>rpcapd</code>。远程后台程序会解析所有的参数，并把它们保存到指定的配置文件中。</p>
<h3>启动远程后台程序，作为一个标准执行进程</h3>
<p><code>rpcapd</code>可以直接启动，比如，它可以运行在前台(不作为后台程序或服务)。不走很简单，你需要从命令行启动程序，并输入所有必要的参数，除了&quot;-d&quot;标志。这样，捕获服务会在前台启动。</p>
<h2><a name="StartCap"></a>在远程主机上启动捕获</h2>
<p>如果你使用的工具已经知道如何进行远程捕获(比如Analyzer)，那么一切都是简单的。捕获向导会帮助你在远程机器上建立合适的接口。</p>
<p>如果你喜欢那些还没有远程捕获功能的工具，你仍然可以进行远程捕获。在这里，你需要阅读下一节的内容。</p>
<p><b>特别小心</b>: 捕获服务 (<code>rpcapd</code>) 必须启动并在远程机器上运行。</p>
<h3>用于选择接口的新字符串标识</h3>
<p>如果你喜欢的工具还没有远程捕获功能，你必须做的唯一一件事，就是插入一个你想要连接的远程主机。可以使用以下形式：</p>
<div align="left">
  <table border="1">
    <tr>
      <th>适配器字符串</th>
      <th>描述</th>
    </tr>
    <tr>
      <td>
        <pre>file://filename</pre>
      </td>
      <td>打开一个本地文件</td>
    </tr>
    <tr>
      <td>
        <pre>rpcap://host.foo.bar/adaptername</pre>
      </td>
      <td>打开一个远程适配器，host用文字来指明，没有端口号(即使用默认RPCAP端口)</td>
    </tr>
    <tr>
      <td>
        <pre>rpcap://host.foo.bar:1234/adaptername</pre>
      </td>
      <td>作用和上面的一样，只是指定了端口号</td>
    </tr>
    <tr>
      <td>
        <pre>rpcap://10.11.12.13/adaptername</pre>
      </td>
      <td>打开一个远程适配器，只是，主机由一个IPv4地址给出，没有端口号(使用RPCAP默认端口)</td>
    </tr>
    <tr>
      <td>
        <pre>rpcap://10.11.12.13:1234/adaptername</pre>
      </td>
      <td>作用和上面的一样，只是指定了端口号</td>
    </tr>
    <tr>
      <td>
        <pre>rpcap://[10.11.12.13]:1234/adaptername</pre>
      </td>
      <td>作用和上面的一样，只是将地址写入了方括号中，这样，更像是IPv6地址的表示方式</td>
    </tr>
    <tr>
      <td>
        <pre>rpcap://[1:2:3::4]/adaptername</pre>
      </td>
      <td>打开一个远程适配器，只是，主机由一个IPv6地址给出，没有端口号(使用RPCAP默认端口)。你必须使用方括号来表示一个IPv6地址。</td>
    </tr>
    <tr>
      <td>
        <pre>rpcap://[1:2:3::4]:1234/adaptername</pre>
      </td>
      <td>作用和上面的一样，只是指定了端口号</td>
    </tr>
    <tr>
      <td>
        <pre>rpcap://adaptername</pre>
      </td>
      <td>打开一个本地适配器，不使用RPCAP协议</td>
    </tr>
    <tr>
      <td>
        <pre>adaptername</pre>
      </td>
      <td>打开一个本地适配器，尽管它可行，但我们强烈不鼓励使用。</td>
    </tr>
    <tr>
      <td>
        <pre>(NULL)</pre>
      </td>
      <td>它将打开第一个本地适配器。尽管它是可行的，但我们强烈不鼓励使用。</td>
    </tr>
  </table>
</div>
<p>以下形式是不对的</p>
<table border="1">
  <tr>
    <th>适配器字符串</th>
    <th>描述</th>
  </tr>
  <tr>
    <td>
      <pre>rpcap://</pre>
    </td>
    <td>它不能打开第一个本地适配器</td>
  </tr>
  <tr>
    <td>
      <pre>rpcap://hostname/</pre>
    </td>
    <td>它不能打开第一个本地适配器</td>
  </tr>
</table>
<h2><a name="UNIX"></a>在UNIX上安装远程后台捕获程序</h2>
<p>WinPcap程序同样可以在UNIX上进行编译。目前，远程捕获已经在Linux和BSD上经过了测试。你需要做的，有以下这些事情：</p>
<ul>
  <li>下载WinPcap源文件</li>
  <li>解压缩源文件
    <ul>
      <li>我们建议使用 <code>unzip -a</code> 命令来将DOS文件转换成UNIX的</li>
    </ul>
  </li>
  <li>转到 <code>libpcap</code> 文件夹</li>
  <li>输入命令:
    <ul>
      <li><code>./configure</code></li>
      <li><b>警告</b>: 万一上一个步骤出现了错误，请使用<code>automake</code>(需要2.50以上版本)命令重新生成配置文件</li>
      <li><code>make</code></li>
    </ul>
  </li>
  <li>转到 <code>rpcapd</code> 文件夹</li>
  <li>输入 <code>make</code></li>
</ul>
<p>在默认情况下，远程捕获功能在Linux和FreeBSD上是打开的。万一你不想使用远程捕获功能，你可以在配置的时候，输入：</p>
<pre>    ./configure --disable-remote</pre>
<p>
当你输入 <code>./configure --help</code>，所有的可以使用的参数将列出来。</p>
<p>你刚刚已经得到了：</p>
<ul>
  <li>一个库文件 (<code>libpcap.a</code>), 它可以连接到其他应用程序 (比如 <code>tcpdump</code>) 以便为他开启远程捕获。</li>
  <li>一个远程的可执行程序 (<code>rpcapd</code>) </li>
</ul>
<p><b>警告</b>: 为了运行远程捕获程序( <code>rpcapd</code> daemon), 程序必须符合下列中的一条：</p>
<ul>
  <li>以root权限运行 (或)</li>
  <li>以user身份运行，但它必须属于root，并且必须有SUID root (<code>chmod
    u+s rpcapd</code>)</li>
</ul>
<h3>已知的BUG</h3>
<p><b>FreeBSD</b>: 你第一次调用 <code>pcap_stat()</code>时，函数会过段时间才返回。因此，像Analyzer这样的程序，在开始捕捉的时候，会停滞20-30秒。
 (if this is done
with BSD as a remote probe). 我们正在调查并试图解决这个问题。</p>
<p><i>如有任何问题，请访问 WinPcap 的帮助页面。</i></p>

</body>

</html>
 
<hr>
<p align="right"><img border="0" src="winpcap_small.gif" align="absbottom" width="91" height="27">
documentation. Copyright (c) 2002-2005 Politecnico di Torino. Copyright (c) 2005-2007 
CACE Technologies. All rights reserved.
<br>2007 Translated By <a href="http://www.CoffeeCat.net.cn" target="_blank">CoffeeCat Studio</a>
</p>
